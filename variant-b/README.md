### `README.md` の修正案

# Gemini PWA (拡張版)

このプロジェクトは、[titan823/geminipwa](https://github.com/titan823/geminipwa) をフォークし、**AI との連携を強化する独自の機能**を追加したバージョンです。

本バージョンでは、特に AI による動的な画像表示を安定させるための「**画像 URL プレースホルダー変換機能**」を搭載しています。

---

### 🌟 主な新機能: 画像 URL プレースホルダー変換

AI による URL 生成の不安定さを解消し、動的ながらも確実な画像表示を実現するための機能です。

#### なぜこの機能が必要か？

AI は完全な URL を正確に生成するのが苦手で、しばしば形式ミス（ハイフンやスラッシュの抜け・重複など）を起こします。この機能は、AI のタスクを「**文脈に合ったキーワードを選択する**」という得意な作業に単純化させ、URL の組み立てという技術的な処理を PWA 側が担うことで、エラーを劇的に減らします。

#### 機能の概要

- **有効化:** 設定画面の「画像 URL 変換設定」で機能を有効にし、画像の起点となるベース URL を設定します。
- **動作:** AI が応答内で `![alt text]({{image_URL}}/...)` のようなプレースホルダーを含むテキストを生成すると、PWA が画面表示の直前に、設定されたベース URL に自動的に置き換えます。
- **堅牢性:** `{{image_URL}}` だけでなく、`{{画像URL}}`, `{{imageUrl}}` といった AI が出力しがちな類似パターンも吸収できるように設計されています。これにより、AI の出力が多少揺れても安定して画像を表示できます。

---

### 利用方法

**当 PWA はブラウザから以下の URL にて利用可能です：**
[https://tomo00024.github.io/geminipwa-NV/variant-b/](https://tomo00024.github.io/geminipwa-NV/variant-b/)

1.  **インストールと API キー設定:**

    - この PWA をブラウザの機能でインストールします。
    - 設定画面で、ご自身の AI サービス API キー（例: Gemini API キー）を設定してください。

2.  **画像 URL 変換機能の設定:**

    - 設定画面の「**画像 URL 変換設定**」セクションを開きます。
    - 「AI 応答内の画像 URL プレースホルダーを変換する」にチェックを入れます。
    - 表示された入力欄に、ご自身で用意した画像の**ベース URL**を入力します。（例: `https://example.com/images`）

3.  **プロンプトの設定:**

    - AI への指示（システムプロンプトなど）を修正し、新しい画像出力形式を教えます。**`{{image_URL}}` を使うのが最も安定しやすいため推奨されます。**

4.  **チャット開始:**
    - チャットを開始し、AI がプロンプトに従ってプレースホルダー付きの応答を生成し、それが正しく画像に変換されることを確認します。

---

#### プロンプトの設定例

AI に、以下のようなプロンプトを与えることを推奨します。AI はこの指示に従い、`{}` の部分を文脈に応じて選択します。

```
# 画像出力ルール
キャラクターの感情や行動を描写する際、以下の形式でMarkdown画像を出力してください。

`![alt text]({{image_URL}}/{キャラクター名}/{服装}/{表情}.avif)`

- プレースホルダーは、必ず `{{image_URL}}` を使用してください。
- `{キャラクター名}`, `{服装}`, `{表情}` の部分は、後述のリストから文脈に最も適したものを選んでください。

# 選択可能なキーワードリスト
- キャラクター名: ゆず, アオイ
- 服装: 制服, 私服, パジャマ
- 表情: 笑顔, 怒り, 悲しみ, はにかむ
```

#### 動作例

- **AI への指示:** 上記プロンプトを設定。
- **AI の出力:**
  `![はにかむゆず]({{image_URL}}/ゆず/私服/はにかむ.avif)`
- **PWA による変換後の URL:**
  `https://(あなたが設定したベースURL)/ゆず/私服/はにかむ.avif`
- **チャット画面での表示:**
  上記の URL の画像が正しく表示されます。

#### 注意事項

- この機能は、AI がプロンプトの指示に従い、プレースホルダーを含む文字列を出力することが前提です。
- 表示する画像は、あらかじめご自身で用意し、Web サーバー等でホスティングしておく必要があります。**このツール自体が画像を生成するわけではありません。**

---

### 重要事項・免責事項

- このフォークは、個人的な利用のために作成されたものであり、オリジナルの `geminipwa` プロジェクトとは独立しています。
- 本プロジェクトは**サポートを提供しません**。また、予告なく仕様変更や更新が終了する可能性があります。
- 初めてデバイスで使用する際は、必ず必要最低限の機能からテストしてください。
- スマートフォンブラウザでの使用を想定しており、アプリ化や PC 上でのローカル使用は十分にテストされていません。
- 問題が発生した場合は、設定画面の「アプリを更新 (キャッシュクリア)」や「強制復旧」をお試しください。
- セッション履歴やプロンプトなどのデータは永続的に保存されることを意図しておらず、自動バックアップ機能もありません。重要なデータはご自身でエクスポート機能などを使いバックアップしてください。
