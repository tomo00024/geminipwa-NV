---
### `README.md` 最終案

# Gemini PWA (拡張版: 多機能画像表示)

このプロジェクトは、[titan823/geminipwa](https://github.com/titan823/geminipwa) をフォークし、AIとの対話中に動的に画像を生成・表示するための2つの異なるアプローチ（**推奨**と**実験的**）を実装した独自拡張バージョンです。

オリジナルの Gemini PWA クライアントが持つ豊富な機能に加え、AIによるURL生成の不安定さを解決し、より表現力豊かなチャット体験を実現することを目指しています。

**当PWAはブラウザから以下のURLにて利用可能です：**
- **推奨版 (variant-b):** [https://tomo00024.github.io/geminipwa-NV/variant-b/](https://tomo00024.github.io/geminipwa-NV/variant-b/)

- **非推奨版　実験的機能搭載版 (variant-a):** [https://tomo00024.github.io/geminipwa-NV/variant-a/](https://tomo00024.github.io/geminipwa-NV/variant-a/)
---

## 🌟 実装された画像表示機能

この PWA には、2 つの異なる画像表示機能が実装されています。それぞれの特徴を理解し、用途に合わせてご利用ください。

### 1. 画像 URL プレースホルダー変換機能 (推奨)

AI の出力を安定させ、確実な画像表示を実現するための、シンプルで堅牢な機能です。

#### 概要

- **仕組み:** AI には `{{画像URL}}` という特別な目印（プレースホルダー）を含む部分的なパスを出力させ、PWA 側でその目印を設定画面で指定したベース URL に自動的に置換します。
- **メリット:**
  - **高安定性:** AI が苦手な URL の完全な構文生成を回避するため、URL の形式ミスが起こりません。
  - **高保守性:** 画像のホスティング先ドメインが変わっても、PWA の設定を 1 箇所変更するだけで対応できます。
  - **高品質なテキスト:** AI がテキスト生成に集中できるため、会話の品質が低下しにくいです。
- **設定方法:**
  1.  設定画面で「**画像 URL 変換設定**」を有効にします。
  2.  ご自身で用意した画像の**ベース URL**を入力します。（例: `https://example.com/images`）
  3.  AI へのプロンプトで、`![alt text]({{画像URL}}/path/to/image.png)` の形式で出力するよう指示します。

---

### 2. 小説シーンビジュアライザー (実験的 / 非推奨)

Gemini の**Function Calling (Tool Use)**機能を活用し、より複雑な条件で画像を動的に選択・表示する実験的な機能です。

#### 概要

- **仕組み:** 設定画面で画像 URL のテンプレートとパラメータ（キャラクター、服装、表情など）を JSON 形式で定義します。AI は会話の文脈を解釈し、最適なパラメータを Function Calling で選択して PWA に伝えます。PWA はその情報に基づいて画像 URL を組み立てて表示します。
- **設定方法:**
  1.  設定画面で「**小説シーンビジュアライザー (Gemini 専用)**」を有効にします。
  2.  画像 URL のテンプレートとパラメータを JSON で設定します。
  3.  「アドバンスド」設定内の「ダミー User プロンプト」に、Function Calling を強制する指示を追加します。
- **現状の課題と評価 (非推奨の理由):**
  - **出力文字数の減少:** Function Calling を併用すると、AI の応答テキストが著しく短くなる傾向があります。
  - **追加指示が必須:** 安定して動作させるには「`display_novel_image`を必ず選択してください.
    文字数を増やしてください。」といった、追加の指示（おまじない）が必要です。
  - **パラメータ選択の失敗:** AI が JSON で定義された選択肢（`enum`）を無視し、`私服`を`私-724`のように誤って出力することがあります。
  - **パフォーマンス:** Function Calling の処理が入るため、応答遅延やトークン消費量の増加が懸念されます。

#### まとめ

このアプローチは技術的に興味深いものの、現状では出力品質の低下という大きなデメリットを抱えています。そのため、**安定したテキスト品質と確実な画像表示を求める場合は、推奨機能である「画像 URL プレースホルダー変換機能」のご利用をお勧めします。**

---

### 重要事項・免責事項

- このフォークは、個人的な利用のために作成されたものであり、オリジナルの `geminipwa` プロジェクトとは独立しています。
- 本プロジェクトは**サポートを提供しません**。また、予告なく仕様変更や更新が終了する可能性があります。
- 初めてデバイスで使用する際は、必ず必要最低限の機能からテストしてください。
- スマートフォンブラウザでの使用を想定しており、アプリ化や Windows 上でのローカル使用はデバッグされていません。
- 問題が発生した場合は、PWA のキャッシュ削除を試みてください。
- セッション履歴やプロンプトなどのデータは永続的に保存されることを意図しておらず、自動バックアップ機能もありません。重要なデータはご自身でバックアップしてください。
